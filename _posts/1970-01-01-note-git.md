---
layout: post
title: Git 操作筆記
date: 1970-01-01 12:00
author: Poy Chang
comments: true
categories: [Note]
---
# Git Cheat Sheet

<a href="http://i.imgur.com/VU8m5Nt.png" target="_blank">
    ![Git-Cheat-Sheet](http://i.imgur.com/VU8m5Nt.png)
</a>

# Pro Git

此為精進 Git 技巧的書籍，有善心人士幫忙翻譯成中文電子版，幾乎所有的用法和技巧裡面都有交代到。

<a href="http://iissnan.com/progit/index.zh-tw.html" target="_blank">
  ![Pro Git in Chinese](http://i.imgur.com/kuMbpo2m.jpg)
</a>

# gitignore 大全

[.gitignore for VisualStudio](https://github.com/github/gitignore/blob/master/VisualStudio.gitignore)

[Github - A collection of useful .gitignore templates](https://github.com/github/gitignore)：各項專案可參考使用的 .gitignore 

# 基本指令

## 建立 Repository

```bash
$ git init
$ git add README
$ git status
$ git commit -m "First Commit"
```

## 常用指令

```bash
$ git status # 查看發生改動的文件列表
$ gitk # 圖形化工具查看文件改動，Git 自帶的圖形化界面
$ git checkout . # 取消所有修改
$ git checkout xxxFile # 取消某個文件的修改
$ git add -A # 新增所有修改
$ git commit -m 'commit message' # 提交修改

$ git push # 提交程式碼到遠程分支, 預設使用 origin 作為名稱
$ git pull # 從遠程倉庫獲取最新程式碼

$ git fetch # 從遠程獲取 branch/tag 訊息
$ git branch # 查看本地分支, -r 查看遠程分支, -a 查看所有
$ git checkout develop # 切換到 develop 分支, -b 新建並切換到分支
$ git merge develop # 將 develop 分支 merge 到當前分支

$ git tag # 查看 tag
$ git tag -a v1.0 -m 'tag message' # 新增 tag
$ git push --tags # 同時推送 tag 到遠程倉庫

$ git help xxxCmd # 查看幫助文件, 會用瀏覽器打開 html 文件
$ git config --global user.name "User-Name" # Git 設定, --global 全局生效
```

## 使用 Stash 暫存功能

```bash
$ git stash # 暫存本地修改
$ git stash pop # 恢復暫存的修改
```

# 進階指令

## 檔名大小寫的重新命名

git 對於檔名的處理是大小寫不分的(case-insensitive)
如果只是把 program.cs 改為 Program.cs，用 git status 會看不到任何改變，請使用下列命令列處理

```bash
$ git mv -f program.cs Program.cs
```

## 修改版控資料夾名稱

使用 `rename` 或 `move` 做資料夾更名

```bash
git mv <old name> <new name>
```

## 拋棄所有尚未commit的資料

```bash
$ git reset --hard    #to discard changes made to versioned files
$ git clean -xdf      #to erase new (untracked) files, including ignored ones (the x option). d is to also remove untracked directories and f to force.
```

## 刪除遠端和本地端的分支

http://stackoverflow.com/questions/2003505/delete-a-git-branch-both-locally-and-remotely
As of Git v1.7.0, you can delete a remote branch using

```bash
$ git push origin --delete <branchName>
```

## 透過 https 下載套件，取代 git protocol

現在前端套件幾乎都會透過 Bower 來下載，而 Bower 預設使用 git protocol 來下載原始檔案，如果遇到 timeout 逾時，也就是無法透過 git:// 方式，就必須要切換成 https:// 下載，切換方式很容易，請在 Console 鍵入底下指令：

```bash
$ git config --global url."https://".insteadOf git://
```

## 移除 Git 歷史紀錄

[參考本站文章](../git-how-to-remove-file-and-commit-from-history/)

## 移除前次 commit

git reset 可以砍掉 commit 重來，但修改的程式依然存在：

```bash
git reset HEAD^
```

執行上列指令就會回到前一版本，其中 `^` 表示是前一版，可以使用多個 `^` 來回到多前 n 版。

此指令常用於發現前一次 commit 有問題時，可以回到前一次 commit，並於修改後再重新 commit。

## 將檔案加入上一個 commit

REF: [How to add a file to the last commit in git?](https://stackoverflow.com/questions/40503417/how-to-add-a-file-to-the-last-commit-in-git)

如果已經 commit 了，但想將再加入檔案時，可以下列指令

```bash
git add THE_FILE_YOU_WANT_TO_ADD
git commit --amend --no-edit
```

`--no-edit` 參數允許你修改上一個 commit 的內容，而不修改其 commit 訊息

## 設定 Git 自訂指令

可以使用 `git config alias.CUSTOME CUSTOM_COMMAND` 來設定自訂指令，之後執行 `git CUSTOME` 就可以了

推薦執行下列指令，建立 `git ll` 顯示簡易的命令列線圖

```bash
$ git config --global alias.ll "log --pretty=format:'%h %ad | %s%d [%Cgreen%an%Creset]' --graph --date=short"
```

![git ll](https://i.imgur.com/mt31KPC.png)

## 協作專案時常用指令

* 自訂 push/fetch 不同的來源
	* 透過 git config 設定
		* `git config --local remote.origin.url <fetchurl>`
		* `git config --local remote.origin.pushurl <pushurl>`
	* 透過 git remote 設定
		* `git remote set-url origin <fetchurl>`
		* `git remote set-url origin --push <pushurl>`
	* 查看遠端儲存庫設定
		* `git remote -v`

# Git 內部細節

## .git 資料夾

* `.git` 資料夾包含整個版控的設定及歷史紀錄
	* 這也是完整的儲存庫備份

## 資料結構

整個 Git 的資料結構主要由四種物件組成

* 物件(Object)
	* 執行 `git add`, `git tag` 指令就會產生物件
	* 查看物件的指令 `git cat-file -t [SHA-1]`
		* SHA-1 是使用檔案內容做 HASH 所產生的 
		* `-t` 顯示該物件的類別
		* `-s` 內容大小
		* `-p` 顯示內容
	* blob
		* 紀錄資料快照，不存檔名
	* tree
		* 這裡面會有檔名和 Object 的對照
	* commit
		* 裡面的 author 和 committer 可能是不同的
		* 當使用 rebase 的時候，會重新 commit 原作者的內容，這時候 cimmitter 就會是新的人
		* 在 GUI 工具中看到的線圖，就是 commit 物件的資訊
	* tag
		* 指向某一個 commit
		* tag 有兩種樣態，一個是這裡的 Object，另一個是參考的指標，存放在 `refs/tags`
* 索引(Index)
	* 索引檔內會有所有版控中的檔案，保存要進儲存庫之前的所有檔案狀態
	* 當資料要寫入 git 的時候，會需要索引檔
	* 空的資料夾是無法加入版控的，如果硬要加入版控了話，至少要有一個檔案，建議用 `.gitkeep`
* 分支(Branch)
	* 記錄在 `.git\refs\heads` 資料夾下，例如 master
	* 內容是一個 SHA-1 的指標，指向一個 commit

# Git Client Tools

指令視作強大的，但畢竟人是視覺動物，有時候看到畫面（線圖）會感覺比較親切。

* [SourceTree](https://www.sourcetreeapp.com/)
	* 跨平台，免費，可切換成中文介面
	* [官方教學文件](https://confluence.atlassian.com/get-started-with-sourcetree)
	* 初次使用容易上手
* [GitKraken](https://www.gitkraken.com/)
	* 跨平台，社群版免費，可付費使用[專業版功能](https://www.gitkraken.com/pro)
	* 畫面很像在打電動，感覺帥氣


----------

參考資料：

* [Git rebase 和 merge 合併操作示範錄影](https://ihower.tw/blog/archives/6704)
* [Git-rebase 小筆記](https://blog.yorkxin.org/2011/07/29/git-rebase)
* [更新從 GitHub 上 fork 出來的 repository (或是同步兩個不同 server 端的 repository)](https://www.peterdavehello.org/2014/02/update_forked_repository/)